<!DOCTYPE html>
<html >
<head>
	<meta charset="UTF-8">
	<title>bird</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1,user-scalable=no">
	<style>
		*{margin:0;padding: 0;}
	</style>
</head>
<body>

<canvas id="myCanvas" ></canvas>

	<script>
		window.w = screen.availWidth
		window.h = screen.availHeight
		var myCanvas = document.getElementById('myCanvas')

		myCanvas.setAttribute("width", w);
		myCanvas.setAttribute("height", h);

		window.addEventListener('resize', resizeCanvas,false)
		function resizeCanvas() {
			w = screen.availWidth
			h = screen.availHeight
		}

		var imageFromPath = function (path) {
			var img = new Image() 
			img.src = path
			// console.log(path)
			return img

		}

		var Back = function () {
			var image = imageFromPath('resource/bg.png')

			var o = {
				x : 0,
				y : 0,
				w : w,
				h : h,
				image : image,		
			}
			return o
		}

		var Bird = function () {
			var image = imageFromPath('resource/bird.png')

			var o = {
				x : 150,
				y : 200,
				w : 30,
				h : 30,
				sx : [0,36,72], //切片位置
				sy : 0,
				sw : 36,
				sh : 26,
				image : image,
				i : 0,	//切片坐标
				jumph: 45,
				jumped: false,
				g : 0.5,

			}
			o.jump = function () {
				o.jumped = true
				o.y -= o.jumph
				o.g = 0
			}
			o.fallDown = function () {
				// console.log(o.g)
				o.jumped = false
				o.y += o.g
				o.g += 1
				if (o.y > h-90) {
					o.y = h -90
					o.g = 0
				}
			}
			
			return o
		}

		var Ground = function () {
			var image = imageFromPath('resource/ground.png')

			var o = {
				x : 0,
				y : h-75,
				w : 2*w,
				h : 75,
				image : image,	
				offset : 5,	
			}
			o.move = function () {
				o.x -= o.offset
			}
			return o
		}

		var Game = function () {
			var ctx = myCanvas.getContext('2d');

			var g = {
				ctx : ctx,
			}
			g.drawImage = function (drawImage) {

				g.ctx.drawImage(drawImage.image, drawImage.x, drawImage.y,drawImage.w, drawImage.h)
				
			}
			g.sliceImage = function (drawImage) {
				g.ctx.drawImage(drawImage.image, drawImage.sx[drawImage.i], drawImage.sy,drawImage.sw, drawImage.sh,
												 -18, -13,drawImage.w, drawImage.h)
			}

			return g
		}

		var _main = function () {
			var game =  Game()
			var bird =  Bird()
			var bg =  Back()
			var ground =  Ground()
			var start = false
			
			window.addEventListener('touchstart', function (event) {
				bird.jump()
				start = true
				// event.preventDefault()
				console.log(event)
			})
			// window.addEventListener('click', function (event) {
			// 	bird.jump()
			// 	console.log('1')
			// })
			window.addEventListener('keydown', function (event) {
				switch(event.keyCode) {
					case 65:
						bird.x -= 10
						break;
					case 68:
						bird.x += 10
						break;
					case 32:
						bird.jump()
						break;	
				}
				
				// console.log(event.keyCode)
			})
			var birdCount = 3
			var groundCount = 65
			setInterval(function () {
				//update
				birdCount -- 
				if (birdCount == 0) {
					bird.i ++
					
					if ( bird.i == 3) {
						bird.i =0
					}
					birdCount =3
				}

				if(start){
					bird.fallDown()
				}

				groundCount --
				if (groundCount == 0) {
					ground.x = 0
					
					groundCount = 65

				}
					// console.log(ground.x)
				ground.move()
				
				
				//clear
				game.ctx.clearRect(0,0,myCanvas.width,myCanvas.height)

				//draw 
				game.drawImage(bg)
				game.drawImage(ground)	



			
				game.ctx.save();//保存状态
				game.ctx.translate(bird.x,bird.y);//设置画布上的(0,0)位置，也就是旋转的中心点
				game.ctx.rotate(45*Math.PI/180);
				// cgametx.drawImage(img,-img.width/2,-img.height/2);//把图片绘制在旋转的中心点，
				game.sliceImage(bird)
				game.ctx.restore();//恢复状态
		
					
			}, 1000/30)
		}

		_main()


	</script>
</body>
</html>